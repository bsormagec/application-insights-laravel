((o,s)=>{function e(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function t(){var e=sessionStorage.getItem("ai_session_start");return e?Date.now()-parseInt(e,10):0}var n,r,i,a,c={queue:[],batchSize:10,retryLimit:3,retryDelay:1e3,collectEndpoint:o.AppInsightsConfig?.collectEndpoint||"/appinsights/collect",operationId:o.AppInsightsConfig?.operationId||e(),parentId:o.AppInsightsConfig?.parentId||null,pageViewSent:!1,userId:((n=localStorage.getItem("ai_user_id"))||(n=e(),localStorage.setItem("ai_user_id",n)),n),sessionId:((n=sessionStorage.getItem("ai_session_id"))||(n=e(),sessionStorage.setItem("ai_session_id",n),sessionStorage.setItem("ai_session_start",Date.now().toString())),n),getContext:function(){return{userId:this.userId,sessionId:this.sessionId,sessionDuration:t(),url:o.location.href,referrer:s.referrer||null,operationId:this.operationId,parentId:this.parentId}},trackEvent:function(e,t){t=t||{},t=Object.assign({},this.getContext(),t),this.queue.push({type:"event",name:e,properties:t}),this.queue.length>=this.batchSize&&this.flush()},trackPageView:function(e,t,n,r){n=n||{},r=r||{},n=Object.assign({},this.getContext(),n),this.queue.push({type:"pageView",name:e||s.title,url:t||o.location.href,properties:n,measurements:r}),this.flush()},trackMetric:function(e,t,n){n=n||{},n=Object.assign({},this.getContext(),n),this.queue.push({type:"metric",name:e,value:t,properties:n}),this.queue.length>=this.batchSize&&this.flush()},trackDependency:function(e,t,n,r,i,o){o=o||{},o=Object.assign({},this.getContext(),o),this.queue.push({type:"dependency",name:e,url:t,duration:n,success:r,responseCode:i,properties:o}),this.queue.length>=this.batchSize&&this.flush()},trackBrowserTimings:function(){var e=this;"complete"===s.readyState?e._sendBrowserTimings():o.addEventListener("load",function(){setTimeout(function(){e._sendBrowserTimings()},100)})},_sendBrowserTimings:function(){if(!this.pageViewSent){this.pageViewSent=!0;var e,t=o.performance&&o.performance.timing,n=o.performance&&o.performance.getEntriesByType?o.performance.getEntriesByType("navigation")[0]:null,r={},i=Object.assign({},this.getContext(),{userAgent:navigator.userAgent,screenResolution:screen.width+"x"+screen.height,viewportSize:o.innerWidth+"x"+o.innerHeight});for(e in n?(r.networkLatency=Math.round(n.responseStart-n.requestStart),r.serverResponseTime=Math.round(n.responseEnd-n.responseStart),r.domProcessingTime=Math.round(n.domContentLoadedEventEnd-n.responseEnd),r.pageLoadTime=Math.round(n.loadEventEnd-n.startTime),r.domContentLoadedTime=Math.round(n.domContentLoadedEventEnd-n.startTime),r.dnsLookupTime=Math.round(n.domainLookupEnd-n.domainLookupStart),r.tcpConnectTime=Math.round(n.connectEnd-n.connectStart),r.transferSize=n.transferSize||0):t&&(n=t.navigationStart,r.networkLatency=t.responseStart-t.requestStart,r.serverResponseTime=t.responseEnd-t.responseStart,r.domProcessingTime=t.domContentLoadedEventEnd-t.responseEnd,r.pageLoadTime=t.loadEventEnd-n,r.domContentLoadedTime=t.domContentLoadedEventEnd-n,r.dnsLookupTime=t.domainLookupEnd-t.domainLookupStart,r.tcpConnectTime=t.connectEnd-t.connectStart),r)r[e]<=0&&delete r[e];this.queue.push({type:"pageView",name:s.title||"Page View",url:o.location.href,properties:i,measurements:r}),0<Object.keys(r).length&&this.queue.push({type:"browserTimings",name:s.title||"Page View",url:o.location.href,properties:i,measurements:r}),this.flush()}},trackException:function(e,t){t=t||{},t=Object.assign({},this.getContext(),t);try{e instanceof Error&&(e={message:e.message,stack:e.stack}),this.queue.push({type:"exception",error:e,properties:t}),this.queue.length>=this.batchSize&&this.flush()}catch(e){console.error("Failed to track exception:",e)}},flush:function(){var e;this.collectEndpoint&&0!==this.queue.length&&(e=this.queue.splice(0,this.batchSize),this.sendBatch(e,0))},sendBatch:function(t,n){var r=this;try{fetch(this.collectEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then(function(e){if(!e.ok)throw new Error("HTTP error "+e.status)}).catch(function(e){n<r.retryLimit&&setTimeout(function(){r.sendBatch(t,n+1)},r.retryDelay*Math.pow(2,n))})}catch(e){console.error("Failed to flush telemetry batch:",e)}}};if(o.appInsights=c,r=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send,XMLHttpRequest.prototype.open=function(e,t){return this._aiMethod=e,this._aiUrl=t,this._aiStartTime=null,r.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){var n=this;return n._aiStartTime=performance.now(),n.addEventListener("loadend",function(){var e=performance.now()-n._aiStartTime,t=200<=n.status&&n.status<400;n._aiUrl&&-1===n._aiUrl.indexOf("/appinsights/collect")&&c.trackDependency(n._aiMethod+" "+n._aiUrl,n._aiUrl,Math.round(e),t,n.status,{type:"XHR"})}),i.apply(this,arguments)},a=o.fetch,o.fetch=function(e,t){var r="string"==typeof e?e:e.url,i=t&&t.method||"GET",o=performance.now();return a.apply(this,arguments).then(function(e){var t=performance.now()-o,n=e.ok;return-1===r.indexOf("/appinsights/collect")&&c.trackDependency(i+" "+r,r,Math.round(t),n,e.status,{type:"Fetch"}),e}).catch(function(e){var t=performance.now()-o;throw-1===r.indexOf("/appinsights/collect")&&c.trackDependency(i+" "+r,r,Math.round(t),!1,0,{type:"Fetch",error:e.message}),e})},o.PerformanceObserver){try{new PerformanceObserver(function(e){e=e.getEntries(),e=e[e.length-1];c.trackMetric("WebVital_LCP",Math.round(e.startTime),{element:e.element?e.element.tagName:"unknown",size:e.size})}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){c.trackMetric("WebVital_FID",Math.round(e.processingStart-e.startTime),{name:e.name})})}).observe({type:"first-input",buffered:!0})}catch(e){}try{var u=0;new PerformanceObserver(function(e){e.getEntries().forEach(function(e){e.hadRecentInput||(u+=e.value)})}).observe({type:"layout-shift",buffered:!0}),o.addEventListener("visibilitychange",function(){"hidden"===s.visibilityState&&0<u&&(c.trackMetric("WebVital_CLS",Math.round(1e3*u)/1e3),c.flush())})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){"first-paint"===e.name?c.trackMetric("WebVital_FP",Math.round(e.startTime)):"first-contentful-paint"===e.name&&c.trackMetric("WebVital_FCP",Math.round(e.startTime))})}).observe({type:"paint",buffered:!0})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){c.trackMetric("LongTask",Math.round(e.duration),{attribution:e.attribution?e.attribution[0]?.name:"unknown"})})}).observe({type:"longtask",buffered:!0})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){e.interactionId&&c.trackMetric("WebVital_INP",Math.round(e.duration),{name:e.name,interactionId:e.interactionId})})}).observe({type:"event",buffered:!0,durationThreshold:40})}catch(e){}}o.addEventListener("error",function(e){c.trackException({message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error?e.error.stack:null}),c.flush()}),o.addEventListener("unhandledrejection",function(e){c.trackException({message:"Unhandled promise rejection",reason:String(e.reason)}),c.flush()}),o.addEventListener("beforeunload",function(){c.flush()}),o.addEventListener("visibilitychange",function(){"hidden"===s.visibilityState&&(c.trackEvent("SessionActivity",{duration:t()}),c.flush())}),c.trackBrowserTimings()})(window,document);