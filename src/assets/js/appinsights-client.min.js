!function(e,t){"use strict";function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function r(){var e=sessionStorage.getItem("ai_session_start");return e?Date.now()-parseInt(e,10):0}var i,s,o={queue:[],batchSize:10,retryLimit:3,retryDelay:1e3,collectEndpoint:e.AppInsightsConfig?.collectEndpoint||"/appinsights/collect",operationId:e.AppInsightsConfig?.operationId||n(),parentId:e.AppInsightsConfig?.parentId||null,excludedPaths:e.AppInsightsConfig?.excludedPaths||[],pageViewSent:!1,userId:(s=localStorage.getItem("ai_user_id"),s||(s=n(),localStorage.setItem("ai_user_id",s)),s),sessionId:(i=sessionStorage.getItem("ai_session_id"),i||(i=n(),sessionStorage.setItem("ai_session_id",i),sessionStorage.setItem("ai_session_start",Date.now().toString())),i),isPathExcluded:function(t){if(!this.excludedPaths||0===this.excludedPaths.length)return!1;try{for(var n=new URL(t,e.location.origin).pathname.replace(/^\//,""),r=0;r<this.excludedPaths.length;r++){var i=this.excludedPaths[r];if(this.pathMatchesPattern(n,i))return!0}}catch(e){}return!1},pathMatchesPattern:function(e,t){if(e===t)return!0;var n=t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/\\\*/g,".*");return(n=new RegExp("^"+n+"$")).test(e)},getContext:function(){return{userId:this.userId,sessionId:this.sessionId,sessionDuration:r(),url:e.location.href,referrer:t.referrer||null,operationId:this.operationId,parentId:this.parentId}},trackEvent:function(e,t){t=t||{},t=Object.assign({},this.getContext(),t),this.queue.push({type:"event",name:e,properties:t}),this.queue.length>=this.batchSize&&this.flush()},trackPageView:function(n,r,i,s){i=i||{},s=s||{},i=Object.assign({},this.getContext(),i),this.queue.push({type:"pageView",name:n||t.title,url:r||e.location.href,properties:i,measurements:s}),this.flush()},trackMetric:function(e,t,n){n=n||{},n=Object.assign({},this.getContext(),n),this.queue.push({type:"metric",name:e,value:t,properties:n}),this.queue.length>=this.batchSize&&this.flush()},trackDependency:function(e,t,n,r,i,s){s=s||{},s=Object.assign({},this.getContext(),s),this.queue.push({type:"dependency",name:e,url:t,duration:n,success:r,responseCode:i,properties:s}),this.queue.length>=this.batchSize&&this.flush()},trackBrowserTimings:function(){var n=this;"complete"===t.readyState?n._sendBrowserTimings():e.addEventListener("load",function(){setTimeout(function(){n._sendBrowserTimings()},100)})},_sendBrowserTimings:function(){if(!this.pageViewSent){this.pageViewSent=!0;var n=e.performance&&e.performance.timing,r=e.performance&&e.performance.getEntriesByType?e.performance.getEntriesByType("navigation")[0]:null,i={},s=Object.assign({},this.getContext(),{userAgent:navigator.userAgent,screenResolution:screen.width+"x"+screen.height,viewportSize:e.innerWidth+"x"+e.innerHeight});if(r)i.networkLatency=Math.round(r.responseStart-r.requestStart),i.serverResponseTime=Math.round(r.responseEnd-r.responseStart),i.domProcessingTime=Math.round(r.domContentLoadedEventEnd-r.responseEnd),i.pageLoadTime=Math.round(r.loadEventEnd-r.startTime),i.domContentLoadedTime=Math.round(r.domContentLoadedEventEnd-r.startTime),i.dnsLookupTime=Math.round(r.domainLookupEnd-r.domainLookupStart),i.tcpConnectTime=Math.round(r.connectEnd-r.connectStart),i.transferSize=r.transferSize||0;else if(n){var o=n.navigationStart;i.networkLatency=n.responseStart-n.requestStart,i.serverResponseTime=n.responseEnd-n.responseStart,i.domProcessingTime=n.domContentLoadedEventEnd-n.responseEnd,i.pageLoadTime=n.loadEventEnd-o,i.domContentLoadedTime=n.domContentLoadedEventEnd-o,i.dnsLookupTime=n.domainLookupEnd-n.domainLookupStart,i.tcpConnectTime=n.connectEnd-n.connectStart}for(var a in i)i[a]<=0&&delete i[a];this.queue.push({type:"pageView",name:t.title||"Page View",url:e.location.href,properties:s,measurements:i}),Object.keys(i).length>0&&this.queue.push({type:"browserTimings",name:t.title||"Page View",url:e.location.href,properties:s,measurements:i}),this.flush()}},trackException:function(e,t){t=t||{},t=Object.assign({},this.getContext(),t);try{e instanceof Error&&(e={message:e.message,stack:e.stack}),this.queue.push({type:"exception",error:e,properties:t}),this.queue.length>=this.batchSize&&this.flush()}catch(e){console.error("Failed to track exception:",e)}},flush:function(){if(this.collectEndpoint&&0!==this.queue.length){var e=this.queue.splice(0,this.batchSize);this.sendBatch(e,0)}},sendBatch:function(e,t){var n=this;try{fetch(this.collectEndpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(function(e){if(!e.ok)throw new Error("HTTP error "+e.status)}).catch(function(r){t<n.retryLimit&&setTimeout(function(){n.sendBatch(e,t+1)},n.retryDelay*Math.pow(2,t))})}catch(e){console.error("Failed to flush telemetry batch:",e)}}};e.appInsights=o,function(){var t=XMLHttpRequest.prototype.open,n=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(e,n){return this._aiMethod=e,this._aiUrl=n,this._aiStartTime=null,t.apply(this,arguments)},XMLHttpRequest.prototype.send=function(){var e=this;return e._aiStartTime=performance.now(),e.addEventListener("loadend",function(){var t=performance.now()-e._aiStartTime,n=e.status>=200&&e.status<400;e._aiUrl&&-1===e._aiUrl.indexOf("/appinsights/collect")&&!o.isPathExcluded(e._aiUrl)&&o.trackDependency(e._aiMethod+" "+e._aiUrl,e._aiUrl,Math.round(t),n,e.status,{type:"XHR"})}),n.apply(this,arguments)};var r=e.fetch;e.fetch=function(e,t){var n="string"==typeof e?e:e.url,i=t&&t.method||"GET",s=performance.now();return r.apply(this,arguments).then(function(e){var t=performance.now()-s,r=e.ok;return-1!==n.indexOf("/appinsights/collect")||o.isPathExcluded(n)||o.trackDependency(i+" "+n,n,Math.round(t),r,e.status,{type:"Fetch"}),e}).catch(function(e){var t=performance.now()-s;throw-1!==n.indexOf("/appinsights/collect")||o.isPathExcluded(n)||o.trackDependency(i+" "+n,n,Math.round(t),!1,0,{type:"Fetch",error:e.message}),e})}}(),function(){if(e.PerformanceObserver){try{new PerformanceObserver(function(e){var t=e.getEntries(),n=t[t.length-1];o.trackMetric("WebVital_LCP",Math.round(n.startTime),{element:n.element?n.element.tagName:"unknown",size:n.size})}).observe({type:"largest-contentful-paint",buffered:!0})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){o.trackMetric("WebVital_FID",Math.round(e.processingStart-e.startTime),{name:e.name})})}).observe({type:"first-input",buffered:!0})}catch(e){}try{var n=0;new PerformanceObserver(function(e){e.getEntries().forEach(function(e){e.hadRecentInput||(n+=e.value)})}).observe({type:"layout-shift",buffered:!0}),e.addEventListener("visibilitychange",function(){"hidden"===t.visibilityState&&n>0&&(o.trackMetric("WebVital_CLS",Math.round(1e3*n)/1e3),o.flush())})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){"first-paint"===e.name?o.trackMetric("WebVital_FP",Math.round(e.startTime)):"first-contentful-paint"===e.name&&o.trackMetric("WebVital_FCP",Math.round(e.startTime))})}).observe({type:"paint",buffered:!0})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){o.trackMetric("LongTask",Math.round(e.duration),{attribution:e.attribution?e.attribution[0]?.name:"unknown"})})}).observe({type:"longtask",buffered:!0})}catch(e){}try{new PerformanceObserver(function(e){e.getEntries().forEach(function(e){e.interactionId&&o.trackMetric("WebVital_INP",Math.round(e.duration),{name:e.name,interactionId:e.interactionId})})}).observe({type:"event",buffered:!0,durationThreshold:40})}catch(e){}}}(),e.addEventListener("error",function(e){o.trackException({message:e.message,filename:e.filename,lineno:e.lineno,colno:e.colno,stack:e.error?e.error.stack:null}),o.flush()}),e.addEventListener("unhandledrejection",function(e){o.trackException({message:"Unhandled promise rejection",reason:String(e.reason)}),o.flush()}),e.addEventListener("beforeunload",function(){o.flush()}),e.addEventListener("visibilitychange",function(){"hidden"===t.visibilityState&&(o.trackEvent("SessionActivity",{duration:r()}),o.flush())}),o.trackBrowserTimings()}(window,document);